结合《架构师之路》系统整理下

#### InnoDB，并发高的原因

**1.并发控制保证数据一致性**常见方式有两种：锁和数据多版本。

普通锁：互斥锁，缺点：比较粗暴，不允许其他任务操作

共享锁（读读可以并行，但不能写）和排他锁（写读、写写不可以并行）：两个都有需要的场景

数据多版本：写任务操作新克隆的数据，直至提交，并发读任务可以继续读取旧版本的数据，不至于阻塞。

**快照读，不加锁**，mvcc利用回滚段里的undo操作，即数据的旧版本，提高并发。

**2.读取旧版本数据**

Redo，undo，回滚段



#### InnoDB怎么实现四种隔离级别

用不同的锁策略实现不同的隔离级别

最低级别，读未提交，select语句不加锁

串行化，所有的select语句都会被隐式地转化为select...in share mode加了共享锁，这可能导致如果有未提交的事务正在修改某些行，所有读取这些行的select都会阻塞，一致性最好，并发性最差。

RR可重复读

​	普通的select使用快照读，这是一种不加锁的一致性读，底层使用MVCC来实现；

​	加锁的select、update、delete等语句，它们的锁，依赖于它们是否存在唯一索引上使用了唯一的查询条件或者范围查询条件，**唯一查询条件会使用记录锁，范围查询会使用间隙锁与临键锁。**



RC读提交

​	普通的select使用快照读；

​	加锁的select、update、delete等语句，除了在外键约束检查与及重复键检查会封锁区间，其他时刻只使用记录锁。

#### InnoDB索引纪录上的三种锁

记录锁，它封锁索引纪录，比如where id = 1，会在id=1的索引记录上加锁，以阻止其他事务插入更新删除

间隙锁，它封锁索引记录中的间隙

临键锁，是记录锁与间隙锁的组合。

#### InnoDB，RR和RC快照读的区别